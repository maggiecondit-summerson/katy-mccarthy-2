var FirstPersonMovement=pc.createScript("firstPersonMovement");FirstPersonMovement.attributes.add("camera",{type:"entity",description:"Optional, assign a camera entity, otherwise one is created"}),FirstPersonMovement.attributes.add("power",{type:"number",default:2500,description:"Adjusts the speed of player movement"}),FirstPersonMovement.attributes.add("lookSpeed",{type:"number",default:.25,description:"Adjusts the sensitivity of looking"}),FirstPersonMovement.prototype.initialize=function(){this.force=new pc.Vec3,this.eulers=new pc.Vec3;var e=this.app;e.mouse.on("mousemove",this._onMouseMove,this),e.mouse.on("mousedown",(function(){e.mouse.enablePointerLock()}),this),this.entity.collision||console.error("First Person Movement script needs to have a 'collision' component"),this.entity.rigidbody&&this.entity.rigidbody.type===pc.BODYTYPE_DYNAMIC||console.error("First Person Movement script needs to have a DYNAMIC 'rigidbody' component")},FirstPersonMovement.prototype.update=function(e){this.camera||this._createCamera();var t=this.force,s=this.app,o=this.camera.forward,i=this.camera.right,r=0,n=0;(s.keyboard.isPressed(pc.KEY_A)||s.keyboard.isPressed(pc.KEY_Q))&&(r-=i.x,n-=i.z),s.keyboard.isPressed(pc.KEY_D)&&(r+=i.x,n+=i.z),s.keyboard.isPressed(pc.KEY_W)&&(r+=o.x,n+=o.z),s.keyboard.isPressed(pc.KEY_S)&&(r-=o.x,n-=o.z),0===r&&0===n||(t.set(r,0,n).normalize().scale(this.power),this.entity.rigidbody.applyForce(t)),this.camera.setLocalEulerAngles(this.eulers.y,this.eulers.x,0)},FirstPersonMovement.prototype._onMouseMove=function(e){(pc.Mouse.isPointerLocked()||e.buttons[0])&&(this.eulers.x-=this.lookSpeed*e.dx,this.eulers.y-=this.lookSpeed*e.dy)},FirstPersonMovement.prototype._createCamera=function(){this.camera=new pc.Entity,this.camera.setName("First Person Camera"),this.camera.addComponent("camera"),this.entity.addChild(this.camera),this.camera.translateLocal(0,.5,0)};var SpawnGrass=pc.createScript("spawnGrass");SpawnGrass.attributes.add("grassCount",{type:"number",default:1e3,description:"Number of grass billboards to spawn"}),SpawnGrass.attributes.add("minScaleY",{type:"number",default:.5,description:"Minimum scale for the grass billboards"}),SpawnGrass.attributes.add("maxScaleY",{type:"number",default:1.5,description:"Maximum scale for the grass billboards"}),SpawnGrass.attributes.add("minScaleX",{type:"number",default:.5,description:"Minimum scale for the grass billboards"}),SpawnGrass.attributes.add("maxScaleX",{type:"number",default:1.5,description:"Maximum scale for the grass billboards"}),SpawnGrass.attributes.add("grassPrefab",{type:"entity",description:"Grass billboard entity template"}),SpawnGrass.attributes.add("height",{type:"number",default:0,description:"Where grass is placed on y axis"}),SpawnGrass.prototype.initialize=function(){const a=this.grassPrefab.render.meshInstances[0];var t=this.entity,e=t.getLocalScale().x/2,s=t.getPosition();if(this.app.graphicsDevice.supportsInstancing){const t=this.grassCount,r=new Float32Array(16*t),i=new pc.Mat4;let n=0;const c=new pc.Vec3,o=new pc.Quat,p=new pc.Vec3(1,1,1);for(let a=0;a<t;a++){const a=2*Math.random()*Math.PI,t=Math.random()*e,l=s.x+t*Math.cos(a),d=s.z+t*Math.sin(a);c.set(l,this.height,d),o.setFromEulerAngles(7*Math.random(),7*Math.random(),7*Math.random()),p.set(Math.random()*(this.maxScaleX-this.minScaleX)+this.minScaleX,Math.random()*(this.maxScaleY-this.minScaleY)+this.minScaleY,Math.random()*(this.maxScaleX-this.minScaleX)+this.minScaleX),i.setTRS(c,o,p);for(let a=0;a<16;a++)r[n++]=i.data[a]}const l=pc.VertexFormat.getDefaultInstancingFormat(this.app.graphicsDevice),d=new pc.VertexBuffer(this.app.graphicsDevice,l,t,pc.BUFFER_DYNAMIC,r);a.setInstancing(d)}else console.error("Hardware instancing is not supported on this device.")};var SpawnFlowers=pc.createScript("spawnFlowers");SpawnFlowers.attributes.add("flowerCount",{type:"number",default:500,description:"Number of flower billboards to spawn"}),SpawnFlowers.attributes.add("minScaleY",{type:"number",default:.5,description:"Minimum scale for the flower billboards"}),SpawnFlowers.attributes.add("maxScaleY",{type:"number",default:1,description:"Maximum scale for the flower billboards"}),SpawnFlowers.attributes.add("minScaleX",{type:"number",default:.5,description:"Minimum scale for the flower billboards"}),SpawnFlowers.attributes.add("maxScaleX",{type:"number",default:1,description:"Maximum scale for the flower billboards"}),SpawnFlowers.attributes.add("flowerPrefab_01",{type:"entity",description:"flower billboard entity template"}),SpawnFlowers.attributes.add("flowerPrefab_02",{type:"entity",description:"flower billboard entity template"}),SpawnFlowers.attributes.add("height",{type:"number",default:0,description:"Where flowers are placed on y axis"}),SpawnFlowers.prototype.initialize=function(){var e=this.entity,t=e.getLocalScale().x/2,a=e.getPosition();if(this.app.graphicsDevice.supportsInstancing){const e=this.flowerCount;for(i=1;i<=2;i++){const r=this["flowerPrefab_0"+i].render.meshInstances[0],n=new Float32Array(16*e),s=new pc.Mat4;let o=0;const l=new pc.Vec3,c=new pc.Quat,p=new pc.Vec3(1,1,1);for(let r=0;r<e;r++){const e=2*Math.random()*Math.PI,r=Math.random()*t,i=a.x+r*Math.cos(e),d=a.z+r*Math.sin(e);l.set(i,this.height,d),c.setFromEulerAngles(7*Math.random(),7*Math.random(),7*Math.random()),p.set(Math.random()*(this.maxScaleX-this.minScaleX)+this.minScaleX,Math.random()*(this.maxScaleY-this.minScaleY)+this.minScaleY,Math.random()*(this.maxScaleX-this.minScaleX)+this.minScaleX),s.setTRS(l,c,p);for(let e=0;e<16;e++)n[o++]=s.data[e]}const d=pc.VertexFormat.getDefaultInstancingFormat(this.app.graphicsDevice),w=new pc.VertexBuffer(this.app.graphicsDevice,d,e,pc.BUFFER_DYNAMIC,n);r.setInstancing(w)}}else console.error("Hardware instancing is not supported on this device.")},SpawnFlowers.prototype.update=function(e){};var Videotexture=pc.createScript("videotexture");Videotexture.attributes.add("screenMaterial",{type:"asset",assetType:"material",title:"Screen material"}),Videotexture.attributes.add("materials",{type:"asset",assetType:"material",array:!0}),Videotexture.attributes.add("videoAsset",{type:"asset",assetType:"audio"}),Videotexture.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this),this.playVideo()},Videotexture.prototype.initialize=function(){var e=this.app,t=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R5_G6_B5,autoMipmap:!1});t.minFilter=pc.FILTER_LINEAR,t.magFilter=pc.FILTER_LINEAR,t.addressU=pc.ADDRESS_CLAMP_TO_EDGE,t.addressV=pc.ADDRESS_CLAMP_TO_EDGE;var i=document.createElement("video");i.addEventListener("canplay",(function(e){t.setSource(i)})),i.src=this.videoAsset.getFileUrl(),i.crossOrigin="anonymous",i.loop=!1;var a=i.style;a.width="1px",a.height="1px",a.position="absolute",a.opacity="0",a.zIndex="-1000",a.pointerEvents="none",document.body.appendChild(i);var r=this.screenMaterial.resource;r.emissiveMap=t,r.update(),this.videoTexture=t,this.entity.collision.on("triggerenter",(function(e){i.play()}),this),this.entity.collision.on("triggerleave",(function(e){i.pause()}),this),this.upload=!0},Videotexture.prototype.update=function(e){this.upload=!this.upload,this.upload&&this.videoTexture.upload()};